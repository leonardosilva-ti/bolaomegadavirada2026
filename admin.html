<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Área Administrativa</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Área Administrativa</h1>

<div id="loginDiv">
  <label>Senha de Acesso:</label>
  <input type="password" id="senha">
  <button onclick="login()">Entrar</button>
</div>

<div id="painel" style="display:none;">
  <h2>Participantes</h2>
  <div id="lista"></div>

  <h3>Registrar Números Sorteados</h3>
  <input type="text" id="nums" placeholder="Ex: 01 05 10 21 44 60">
  <button onclick="registrarSorteio()">Registrar</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbylsOPklfzElA8ZYF7wYneORp5nWymkrnDzXhVK-onsnb9PXze16S50yVbu059g_w4tLA/exec";
const SENHA = "Blq15206395!"; // altere aqui

function login() {
  const s = document.getElementById("senha").value;
  if (s === SENHA) {
    document.getElementById("loginDiv").style.display = "none";
    document.getElementById("painel").style.display = "block";
    carregarLista();
  } else alert("Senha incorreta!");
}

async function carregarLista() {
  const res = await fetch(SCRIPT_URL + "?action=get");
  const data = await res.json();
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  data.forEach(p => {
    lista.innerHTML += `
      <div class="card">
        <b>${p.nome}</b> - ${p.telefone} | Pix: ${p.pix} | Status: ${p.status || "Pendente"}
        <br><button onclick="confirmarPagamento('${p.nome}','${p.telefone}')">Confirmar Pagamento</button>
        <button onclick="excluir('${p.nome}','${p.telefone}')">Excluir</button>
      </div>`;
  });
}

async function excluir(nome, telefone) {
  if (!confirm("Excluir este participante?")) return;
  await fetch(`${SCRIPT_URL}?action=delete&nome=${encodeURIComponent(nome)}&telefone=${encodeURIComponent(telefone)}`);
  carregarLista();
}

async function confirmarPagamento(nome, telefone) {
  await fetch(`${SCRIPT_URL}?action=confirmarPagamento&nome=${encodeURIComponent(nome)}&telefone=${encodeURIComponent(telefone)}`);
  carregarLista();
}

async function registrarSorteio() {
  const nums = document.getElementById("nums").value.split(" ").map(n => parseInt(n)).filter(Boolean);
  if (nums.length !== 6) return alert("Informe exatamente 6 números.");
  google.script.run.registrarNumerosSorteados(nums);
  alert("Números sorteados registrados!");
}
</script>
</body>
</html>
