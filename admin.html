<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Área Administrativa</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<main class="container admin">
  <h1>Área Administrativa</h1>

  <div id="loginDiv" class="login-box">
    <h2>Login de Administrador</h2>
    <input type="text" id="usuario" placeholder="Usuário">
    <input type="password" id="senha" placeholder="Senha">
    <button onclick="login()" class="primary">Entrar</button>
  </div>

  <div id="painel" style="display:none;">
    <h2>Participantes</h2>
    <div id="lista"></div>

    <h3>Registrar Números Sorteados</h3>
    <input type="text" id="nums" placeholder="Ex: 01 05 10 21 44 60">
    <button onclick="registrarSorteio()" class="primary">Registrar</button>
  </div>
</main>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbylsOPklfzElA8ZYF7wYneORp5nWymkrnDzXhVK-onsnb9PXze16S50yVbu059g_w4tLA/exec";
const LOGIN = { usuario: "admin", senha: "Blq15206395!" };

function login() {
  const u = document.getElementById("usuario").value;
  const s = document.getElementById("senha").value;
  if (u === LOGIN.usuario && s === LOGIN.senha) {
    document.getElementById("loginDiv").style.display = "none";
    document.getElementById("painel").style.display = "block";
    carregarLista();
  } else {
    alert("Usuário ou senha incorretos.");
  }
}

async function carregarLista() {
  const res = await fetch(SCRIPT_URL + "?action=get");
  const data = await res.json();
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  data.forEach(p => {
    lista.innerHTML += `
      <div class="card">
        <b>${p.Nome}</b><br>${p.Telefone} | Pix: ${p["É chave pix"]}
        <br>Status: <b>${p.Pago === "TRUE" ? "Pago" : "Pendente"}</b><br>
        <button onclick="confirmarPagamento('${p.Nome}','${p.Telefone}')" class="primary small">Confirmar Pagamento</button>
        <button onclick="excluir('${p.Nome}','${p.Telefone}')" class="danger small">Excluir</button>
      </div>
    `;
  });
}

async function excluir(nome, telefone) {
  if (!confirm("Excluir este participante?")) return;
  await fetch(`${SCRIPT_URL}?action=delete&nome=${encodeURIComponent(nome)}&telefone=${encodeURIComponent(telefone)}`);
  carregarLista();
}

async function confirmarPagamento(nome, telefone) {
  await fetch(`${SCRIPT_URL}?action=confirmarPagamento&nome=${encodeURIComponent(nome)}&telefone=${encodeURIComponent(telefone)}`);
  carregarLista();
}

async function registrarSorteio() {
  const nums = document.getElementById("nums").value.split(" ").map(n => parseInt(n)).filter(Boolean);
  if (nums.length !== 6) return alert("Informe exatamente 6 números.");
  alert("Números sorteados registrados com sucesso!");
}
</script>
</body>
</html>
