<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Confirmação da Aposta - Mega da Virada</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="site-header">
    <h1>Confirmação da Aposta</h1>
  </header>

  <main class="container">
    <section id="resumo" class="center">
      <h2>Revise suas informações antes de enviar</h2>
      <div id="dados"></div>
      <div id="jogos"></div>
    </section>

    <div class="controles">
      <button id="voltar" class="muted">Voltar e Editar</button>
      <button id="confirmarEnvio" class="primary">Confirmar e Enviar</button>
    </div>

    <div id="mensagem" class="mensagem"></div>
  </main>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbylsOPklfzElA8ZYF7wYneORp5nWymkrnDzXhVK-onsnb9PXze16S50yVbu059g_w4tLA/exec";

    const payload = JSON.parse(localStorage.getItem("pendingAposta"));
    const dadosDiv = document.getElementById("dados");
    const jogosDiv = document.getElementById("jogos");
    const msg = document.getElementById("mensagem");

    if (!payload) {
      dadosDiv.innerHTML = "<p style='color:red'>Nenhuma aposta encontrada. Retorne à página inicial.</p>";
      document.getElementById("confirmarEnvio").disabled = true;
    } else {
      dadosDiv.innerHTML = `
        <p><b>Nome:</b> ${payload.nome}</p>
        <p><b>Telefone:</b> ${payload.telefone}</p>
        <p><b>É chave PIX?:</b> ${payload.pix}</p>
      `;

      jogosDiv.innerHTML = `
        <h3>Jogos</h3>
        ${payload.jogos.map((j, i) => `<p><b>Jogo ${i + 1}:</b> ${j}</p>`).join("")}
      `;
    }

    document.getElementById("voltar").onclick = () => {
      window.location.href = "index.html";
    };

    document.getElementById("confirmarEnvio").onclick = async () => {
      msg.innerHTML = "<p>Enviando seus dados...</p>";
      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          msg.innerHTML = "<p style='color:green'><b>Aposta enviada com sucesso!</b></p>";
          localStorage.removeItem("pendingAposta");
          setTimeout(() => window.location.href = "comprovante.html", 1500);
        } else {
          msg.innerHTML = "<p style='color:red'>Erro ao enviar. Tente novamente.</p>";
        }
      } catch (e) {
        msg.innerHTML = `<p style='color:red'>Erro: ${e.message}</p>`;
      }
    };
  </script>
</body>
</html>
