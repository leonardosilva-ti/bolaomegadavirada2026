<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Confirmação - Mega da Virada</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <main class="container">
    <h1>Confirmação da Aposta</h1>
    <div id="info"></div>
    <div id="jogos"></div>

    <section class="observacao-box center small">
      <div class="observacao-text" id="obs-static"></div>
    </section>

    <div style="margin-top:12px">
      <label><input type="checkbox" id="aceito2"> Li e aceito os termos</label>
    </div>

    <div style="margin-top:12px">
      <button id="btnBaixar" class="primary">Baixar Comprovante (PDF)</button>
      <button id="btnVoltar" class="muted">Voltar ao Início</button>
    </div>

    <div id="statusPago" style="margin-top:12px"></div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbylsOPklfzElA8ZYF7wYneORp5nWymkrnDzXhVK-onsnb9PXze16S50yVbu059g_w4tLA/exec";
    const last = JSON.parse(localStorage.getItem("lastReceiptData"));
    const obsText = "Este bolão não é realizado de forma oficial pela Caixa Econômica Federal. A organização e divisão de prêmios serão feitas entre os participantes, através de uma pessoa responsável. O site ficará disponível para consulta de todos os jogos, participantes e quantidades, para que todos possam validar individualmente e cobrar o valor de premiação, se houver. Após o sorteio, serão exibidos os números sorteados e se houve ganhadores. Cada participante poderá criar 5 jogos de 6 números, e será feito um jogo adicional de 9 números ao fechar o bolão. Caso o participante deseje, os jogos poderão ser preenchidos de forma aleatória.";
    document.getElementById("obs-static").innerText = obsText;

    if (!last) {
      document.getElementById("info").innerHTML = "<p>Nenhum comprovante encontrado. Volte ao site e envie sua aposta.</p>";
    } else {
      const payload = last.payload;
      const receipt = last.receipt;
      document.getElementById("info").innerHTML = `<p><strong>Nome:</strong> ${payload.nome}<br><strong>Telefone:</strong> ${payload.telefone}<br><strong>Receipt:</strong> ${receipt}</p>`;
      const jogosHTML = (payload.jogos || []).filter(Boolean).map((j,i)=>`<p><strong>Jogo ${String(i+1).padStart(2,"0")}:</strong> ${j}</p>`).join("");
      document.getElementById("jogos").innerHTML = `<h3>Jogos</h3>${jogosHTML}`;

      document.getElementById("btnBaixar").onclick = () => {
        if (!document.getElementById("aceito2").checked) { alert("Você precisa aceitar os termos."); return; }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let y = 12;
        doc.setFontSize(16); doc.text("Comprovante - Bolão Mega da Virada", 12, y); y+=10;
        doc.setFontSize(11); doc.text(`Receipt: ${receipt}`, 12, y); y+=8;
        doc.text(`Nome: ${payload.nome}`, 12, y); y+=8;
        doc.text(`Telefone: ${payload.telefone}`, 12, y); y+=10;
        doc.text("Jogos:", 12, y); y+=8;
        (payload.jogos || []).filter(Boolean).forEach((j,i)=>{
          doc.text(`${String(i+1).padStart(2,"0")}: ${j}`, 12, y); y+=7;
          if (y > 270) { doc.addPage(); y=12; }
        });
        doc.save(`comprovante_${receipt}.pdf`);
        alert("Comprovante gerado — guarde o arquivo.");
      };

      document.getElementById("btnVoltar").onclick = () => {
        window.location.href = "index.html";
      };
    }
  </script>
</body>
</html>
