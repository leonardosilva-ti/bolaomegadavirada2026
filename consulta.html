<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta - Mega da Virada</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="site-header">
    <h1>Consulta de Apostas - Mega da Virada</h1>
  </header>

  <main class="container">

    <!-- Estatísticas do Bolão -->
    <section id="estatisticas">
      <h2>Estatísticas do Bolão</h2>
      <div class="stats-container">
        <div class="stats-card">
          <h4>Participantes</h4>
          <p id="totalParticipantes">00</p>
        </div>
        <div class="stats-card">
          <h4>Jogos Feitos</h4>
          <p id="totalJogos">00</p>
        </div>
      </div>
    </section>

    <!-- Jogo da Sorte -->
    <section class="jogo-sorte-box">
      <h3>Jogo da Sorte (9 Números)</h3>
      <div id="jogoSorteNumeros" class="jogo-sorte-numeros"></div>
    </section>

    <hr>

    <!-- Lista de Jogos -->
    <section id="todosJogos">
      <h3 class="text-center">Jogos dos Participantes</h3>
      <div id="listaJogos" class="todos-jogos"></div>
    </section>

  </main>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbylsOPklfzElA8ZYF7wYneORp5nWymkrnDzXhVK-onsnb9PXze16S50yVbu059g_w4tLA/exec";

    async function carregarEstatisticas() {
      try {
        const response = await fetch(`${SCRIPT_URL}?action=consultarEstatisticas`);
        const data = await response.json();

        document.getElementById("totalParticipantes").textContent = data.participantes || "00";
        document.getElementById("totalJogos").textContent = data.jogos || "00";

        const numeros = (data.jogoSorte || "").split(" ").filter(n => n.trim() !== "");
        const sorteContainer = document.getElementById("jogoSorteNumeros");
        sorteContainer.innerHTML = numeros.map(num => `<span>${num}</span>`).join("");

        const listaJogos = document.getElementById("listaJogos");
        if (Array.isArray(data.lista) && data.lista.length > 0) {
          listaJogos.innerHTML = data.lista
            .map((item, i) => `
              <div class="jogo-item">
                <p><b>${item.nome || "Participante " + (i + 1)}</b></p>
                ${item.jogos.map(j => `<div class="jogo-card">${j}</div>`).join("")}
              </div>
            `)
            .join("");
        } else {
          listaJogos.innerHTML = "<p class='center'>Nenhum jogo registrado ainda.</p>";
        }

      } catch (e) {
        console.error(e);
        document.getElementById("listaJogos").innerHTML = "<p class='center' style='color:red;'>Erro ao carregar dados.</p>";
      }
    }

    carregarEstatisticas();
  </script>
</body>
</html>
